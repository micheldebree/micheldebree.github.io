function Palette(a){"use strict";this.pixels=void 0===a?[]:a}function ColorMap(a,b,c,d){"use strict";this.colors=[],this.width=a,this.height=b,this.resX=void 0!==c?c:a,this.resY=void 0!==d?d:b}function GraphicModes(){"use strict"}function OrderedDitherers(){"use strict"}function ErrorDiffusionDitherer(){"use strict"}function Remapper(a){"use strict";this.targetPixelImage=a}function PixelImage(){"use strict";this.height=void 0,this.width=void 0,this.pWidth=1,this.pHeight=1,this.colorMaps=[],this.palette=void 0,this.pixelIndex=[],this.ditherOffset=[],this.dither=[[0]],this.errorDiffusionDither=function(){},this.mappingWeight=[1,1,1]}angular.module("vicarApp",["ngRoute","webcam"]).config(["$routeProvider","$compileProvider",function(a,b){"use strict";a.when("/",{templateUrl:"views/main.html"}).otherwise({redirectTo:"/"}),b.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|blob|data):/)}]),angular.module("vicarApp").controller("MainCtrl",["$scope",function(a){"use strict";function b(a,b){var c,d,e,f,g,h,i,j;for(c=a.createImageData(b.width*b.pWidth,b.height*b.pHeight),d=0;d<b.width;d+=1)for(e=0;e<b.height;e+=1)for(j=b.peek(d,e),f=0;f<b.pWidth;f+=1)for(h=d*b.pWidth+f,i=e*b.pHeight,g=0;g<b.pHeight;g+=1)PixelCalculator.poke(c,h,i+g,j);a.putImageData(c,0,0)}function c(){var d=a.channel.video,e=document.querySelector("#camvas"),f=e.getContext("2d");f.drawImage(d,0,0,d.width/2,d.height);var g=a.selectedGraphicMode.value();g.dither=a.selectedDither.value,g.errorDiffusionDither=a.selectedErrorDiffusionDither.value,g.mappingWeight=a.selectedPsychedelicMode.value;var h=f.getImageData(0,0,g.width,g.height);new Remapper(g).mapImageData(h),b(f,g),requestAnimationFrame(c)}a.graphicModes=GraphicModes.all,a.selectedGraphicMode=a.graphicModes[0],a.dithers=OrderedDitherers.all,a.selectedDither=a.dithers[2],a.errorDiffusionDithers=ErrorDiffusionDitherer.all,a.selectedErrorDiffusionDither=a.errorDiffusionDithers[0],a.psychedelicModes=[{key:"None",value:[1,1,1]},{key:"Rainbow",value:[1,0,0]},{key:"Candy",value:[1,0,1]},{key:"Forest",value:[1,1,0]}],a.selectedPsychedelicMode=a.psychedelicModes[0],function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=a}(),a.onWebcam=function(){requestAnimationFrame(c)}}]),Palette.prototype.get=function(a){"use strict";return this.pixels[a]},Palette.prototype.getDistance=function(a,b,c,d){"use strict";var e=this.pixels[b];return c=void 0!==c?c:PixelCalculator.emptyPixel,d=void 0!==d?d:[1,1,1],a=PixelCalculator.toYUV(a),e=PixelCalculator.toYUV(e),c=PixelCalculator.toYUV(c),Math.sqrt(d[0]*Math.pow(a[0]-e[0]-c[0],2)+d[1]*Math.pow(a[1]-e[1]-c[1],2)+d[2]*Math.pow(a[2]-e[2]-c[2],2))},Palette.prototype.mapPixel=function(a,b,c){"use strict";var d,e,f,g;for(d=0;d<this.pixels.length;d+=1)e=this.getDistance(a,d,b,c),(void 0===f||e<f)&&(f=e,g=d);return g};var peptoPalette=new Palette([[0,0,0,255],[255,255,255,255],[104,55,43,255],[112,164,178,255],[111,61,134,255],[88,141,67,255],[53,40,121,255],[184,199,111,255],[111,79,37,255],[67,57,0,255],[154,103,89,255],[68,68,68,255],[108,108,108,255],[154,210,132,255],[108,94,181,255],[149,149,149,255]]);ColorMap.prototype.isInRange=function(a,b){"use strict";return a>=0&&a<this.width&&b>=0&&b<this.height},ColorMap.prototype.mapX=function(a){"use strict";return Math.floor(a/this.resX)},ColorMap.prototype.mapY=function(a){"use strict";return Math.floor(a/this.resY)},ColorMap.prototype.add=function(a,b,c){"use strict";if(this.isInRange(a,b)){var d=this.mapX(a);void 0===this.colors[d]&&(this.colors[d]=[]),this.colors[d][this.mapY(b)]=c}},ColorMap.prototype.toImageData=function(a){"use strict";var b,c,d=document.createElement("canvas"),e=d.getContext("2d"),f=e.createImageData(this.width,this.height);for(c=0;c<this.height;c+=1)for(b=0;b<this.width;b+=1)PixelCalculator.poke(f,b,c,a.get(this.getColor(b,c)));return f},ColorMap.prototype.getColor=function(a,b){"use strict";var c=this.mapX(a),d=this.mapY(b);if(void 0!==this.colors[c])return this.colors[c][d]},ColorMap.prototype.reduceToMax=function(a,b,c,d){"use strict";var e,f,g,h,i,j=[];for(e=a;e<a+c;e+=1)for(f=b;f<b+d;f+=1)g=this.getColor(e,f),void 0!==g&&(j[g]=void 0===j[g]?1:j[g]+1,(void 0===h||j[g]>h)&&(h=j[g],i=g));return i},ColorMap.prototype.subtract=function(a){"use strict";var b,c;for(b=0;b<this.width;b+=this.resX)for(c=0;c<this.height;c+=this.resY)this.getColor(b,c)===a.getColor(b,c)&&this.add(b,c,void 0)},ColorMap.prototype.extractColorMap=function(a){"use strict";var b,c,d=a.resX,e=a.resY;for(b=0;b<a.width;b+=d)for(c=0;c<a.height;c+=e)a.add(b,c,this.reduceToMax(b,c,d,e));this.subtract(a)},GraphicModes.c64Multicolor=function(){"use strict";var a=PixelImage.create(160,200,void 0,2,1);return a.palette=peptoPalette,a.colorMaps.push(new ColorMap(160,200)),a.colorMaps.push(new ColorMap(160,200,4,8)),a.colorMaps.push(new ColorMap(160,200,4,8)),a.colorMaps.push(new ColorMap(160,200,4,8)),a},GraphicModes.c64FLI=function(){"use strict";var a=PixelImage.create(160,200,void 0,2,1);return a.palette=peptoPalette,a.colorMaps.push(new ColorMap(160,200)),a.colorMaps.push(new ColorMap(160,200,4,8)),a.colorMaps.push(new ColorMap(160,200,4,1)),a.colorMaps.push(new ColorMap(160,200,4,1)),a},GraphicModes.c64AFLI=function(){"use strict";var a=PixelImage.create(320,200,void 0,1,1);return a.palette=peptoPalette,a.colorMaps.push(new ColorMap(320,200,8,8)),a.colorMaps.push(new ColorMap(320,200,8,1)),a},GraphicModes.c64Hires=function(){"use strict";var a=PixelImage.create(320,200,void 0,1,1);return a.palette=peptoPalette,a.colorMaps.push(new ColorMap(320,200,8,8)),a.colorMaps.push(new ColorMap(320,200,8,8)),a},GraphicModes.all=[{key:"Multicolor",value:GraphicModes.c64Multicolor},{key:"FLI",value:GraphicModes.c64FLI},{key:"AFLI",value:GraphicModes.c64AFLI},{key:"Hires",value:GraphicModes.c64Hires}],OrderedDitherers.all=[{key:"None",value:[[0]]},{key:"Bayer 2 x 2",value:[[1,3],[4,2]]},{key:"Bayer 4 x 4",value:[[1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]]},{key:"Bayer 8 x 8",value:[[1,49,13,61,4,52,16,64],[33,17,45,29,36,20,48,31],[9,57,5,53,12,60,8,56],[41,25,37,21,44,28,40,24],[3,51,15,63,2,50,14,62],[35,19,47,31,34,18,46,30],[11,59,7,55,10,58,6,54],[43,27,39,23,42,26,38,22]]}],ErrorDiffusionDitherer.weighError=function(a,b,c){"use strict";return[a[0]*b/c,a[1]*b/c,a[2]*b/c]},ErrorDiffusionDitherer.fsDither=function(a,b,c,d){"use strict";a.addDitherOffset(b+1,c,ErrorDiffusionDitherer.weighError(d,7,16)),a.addDitherOffset(b-1,c+1,ErrorDiffusionDitherer.weighError(d,3,16)),a.addDitherOffset(b,c+1,ErrorDiffusionDitherer.weighError(d,5,16)),a.addDitherOffset(b+1,c+1,ErrorDiffusionDitherer.weighError(d,1,16))},ErrorDiffusionDitherer.jjnDither=function(a,b,c,d){"use strict";a.addDitherOffset(b+1,c,ErrorDiffusionDitherer.weighError(d,7,48)),a.addDitherOffset(b+2,c,ErrorDiffusionDitherer.weighError(d,5,48)),a.addDitherOffset(b-2,c+1,ErrorDiffusionDitherer.weighError(d,3,48)),a.addDitherOffset(b-1,c+1,ErrorDiffusionDitherer.weighError(d,5,48)),a.addDitherOffset(b,c+1,ErrorDiffusionDitherer.weighError(d,7,48)),a.addDitherOffset(b+1,c+1,ErrorDiffusionDitherer.weighError(d,5,48)),a.addDitherOffset(b+2,c+1,ErrorDiffusionDitherer.weighError(d,3,48)),a.addDitherOffset(b-2,c+2,ErrorDiffusionDitherer.weighError(d,1,48)),a.addDitherOffset(b-1,c+2,ErrorDiffusionDitherer.weighError(d,3,48)),a.addDitherOffset(b,c+2,ErrorDiffusionDitherer.weighError(d,5,48)),a.addDitherOffset(b+1,c+2,ErrorDiffusionDitherer.weighError(d,3,48)),a.addDitherOffset(b+2,c+2,ErrorDiffusionDitherer.weighError(d,1,48))},ErrorDiffusionDitherer.atkinsonDither=function(a,b,c,d){"use strict";a.addDitherOffset(b+1,c,ErrorDiffusionDitherer.weighError(d,1,8)),a.addDitherOffset(b+2,c,ErrorDiffusionDitherer.weighError(d,1,8)),a.addDitherOffset(b-1,c+1,ErrorDiffusionDitherer.weighError(d,1,8)),a.addDitherOffset(b,c+1,ErrorDiffusionDitherer.weighError(d,1,8)),a.addDitherOffset(b+1,c+1,ErrorDiffusionDitherer.weighError(d,1,8)),a.addDitherOffset(b,c+2,ErrorDiffusionDitherer.weighError(d,1,8))},ErrorDiffusionDitherer.all=[{key:"None",value:function(){}},{key:"Floyd-Steinberg",value:ErrorDiffusionDitherer.fsDither},{key:"Jarvis, Judice and Ninke",value:ErrorDiffusionDitherer.jjnDither},{key:"Atkinson",value:ErrorDiffusionDitherer.atkinsonDither}],Remapper.prototype.getColorMap=function(a){"use strict";var b=a.width,c=a.height,d=PixelImage.create(b,c,new ColorMap(b,c,1,1),this.targetPixelImage.pWidth,this.targetPixelImage.pHeight);return d.palette=this.targetPixelImage.palette,d.dither=this.targetPixelImage.dither,d.mappingWeight=this.targetPixelImage.mappingWeight,d.errorDiffusionDither=this.targetPixelImage.errorDiffusionDither,d.drawImageData(a),d.colorMaps[0]},Remapper.prototype.mapImageData=function(a){"use strict";var b,c=this.getColorMap(a);for(b=0;b<this.targetPixelImage.colorMaps.length;b+=1)c.extractColorMap(this.targetPixelImage.colorMaps[b]);this.targetPixelImage.drawImageData(a)},PixelImage.create=function(a,b,c,d,e){"use strict";var f=new PixelImage;return f.pWidth=void 0===d?1:d,f.pHeight=void 0===e?1:e,f.height=b,f.width=a,void 0!==c&&f.colorMaps.push(c),f},PixelImage.prototype.assertValid=function(){"use strict";if(void 0===this.width||void 0===this.height)throw new Error("PixelImage has undefined dimensions.")},PixelImage.prototype.findColorInMap=function(a,b,c){"use strict";var d;for(d=0;d<this.colorMaps.length;d+=1)if(c===this.colorMaps[d].getColor(a,b))return d},PixelImage.prototype.map=function(a,b,c,d){"use strict";var e,f,g,h,i=0;for(e=0;e<this.colorMaps.length;e+=1)h=this.colorMaps[e].getColor(b,c),f=this.palette.getDistance(a,h,d,this.mappingWeight),(void 0===g||f<g)&&(g=f,i=e);return i},PixelImage.prototype.setPixelIndex=function(a,b,c){"use strict";void 0===this.pixelIndex[b]&&(this.pixelIndex[b]=[]),this.pixelIndex[b][a]=c},PixelImage.prototype.getPixelIndex=function(a,b){"use strict";var c=this.pixelIndex[b];return void 0!==c?c[a]:void 0},PixelImage.prototype.setDitherOffset=function(a,b,c){"use strict";a<this.width&&b<this.height&&(void 0===this.ditherOffset[b]&&(this.ditherOffset[b]=[]),this.ditherOffset[b][a]=c)},PixelImage.prototype.addDitherOffset=function(a,b,c){"use strict";var d=this.getDitherOffset(a,b);this.setDitherOffset(a,b,PixelCalculator.add(d,c))},PixelImage.prototype.getDitherOffset=function(a,b){"use strict";var c=this.ditherOffset[b];return void 0!==c&&void 0!==c[a]?c[a]:PixelCalculator.emptyPixel},PixelImage.prototype.orderedDither=function(a,b){"use strict";var c=this.dither[b%this.dither.length][a%this.dither.length];this.addDitherOffset(a+1,b,[c,c,c])},PixelImage.prototype.poke=function(a,b,c){"use strict";var d,e,f,g,h;g=this.getDitherOffset(a,b),d=this.palette.mapPixel(c,g,this.mappingWeight),e=this.palette.get(d),h=PixelCalculator.substract(e,c),this.orderedDither(a,b,c),this.errorDiffusionDither(this,a,b,h),f=this.findColorInMap(a,b,d),void 0===f&&(f=this.findColorInMap(a,b,void 0)),void 0!==f?this.colorMaps[f].add(a,b,d):void 0===f&&(f=this.map(c,a,b,g)),this.setPixelIndex(a,b,f)},PixelImage.prototype.drawImageData=function(a){"use strict";var b,c,d;for(c=0;c<this.height;c+=1)for(b=0;b<this.width;b+=1)d=PixelCalculator.peek(a,b,c),this.poke(b,c,d)},PixelImage.prototype.fromImageData=function(a){"use strict";this.init(a.width,a.height),this.colorMaps=[new ColorMap(this.width,this.height,1,1)],this.drawImageData(a)},PixelImage.prototype.getPaletteIndex=function(a,b){"use strict";var c=this.getPixelIndex(a,b);return void 0!==c?this.colorMaps[c].getColor(a,b):void 0},PixelImage.prototype.peek=function(a,b){"use strict";var c=this.getPaletteIndex(a,b);return void 0!==c?this.palette.get(c):PixelImage.emptyPixel},PixelImage.prototype.toSrcUrl=function(){"use strict";return this.assertValid(),this.toUrl("image/png")},PixelImage.prototype.toDownloadUrl=function(){"use strict";return this.toSrcUrl().replace("data:image/png","data:image/octet-stream")},PixelImage.prototype.toUrl=function(a){"use strict";var b,c,d,e,f,g,h,i,j=document.createElement("canvas"),k=j.getContext("2d");for(j.width=this.width*this.pWidth,j.height=this.height*this.pHeight,b=k.createImageData(j.width,j.height),c=0;c<this.width;c+=1)for(d=0;d<this.height;d+=1)for(i=this.peek(c,d),e=0;e<this.pWidth;e+=1)for(g=c*this.pWidth+e,h=d*this.pHeight,f=0;f<this.pHeight;f+=1)PixelCalculator.poke(b,g,h+f,i);return k.putImageData(b,0,0),j.toDataURL(a)},PixelImage.prototype.addColorMap=function(a){"use strict";this.colorMaps.push(a)},PixelImage.prototype.getTransparencyPercentage=function(){"use strict";var a,b,c=0;for(a=0;a<this.width;a+=1)for(b=0;b<this.height;b+=1)c+=void 0===this.getPixelIndex(a,b)?1:0;return Math.round(100*c/(this.width*this.height))};var PixelCalculator={};PixelCalculator.add=function(a,b){"use strict";return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3]]},PixelCalculator.substract=function(a,b){"use strict";return[a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3]]},PixelCalculator.multiply=function(a,b){"use strict";return[a[0]*b,a[1]*b,a[2]*b]},PixelCalculator.divide=function(a,b){"use strict";return[a[0]/b,a[1]/b,a[2]/b]},PixelCalculator.clone=function(a){"use strict";return[a[0],a[1],a[2],a[3]]},PixelCalculator.isEmpty=function(a){"use strict";return void 0===a[3]||a[3]<1},PixelCalculator.equals=function(a,b){"use strict";return!PixelCalculator.isEmpty(a)&&!PixelCalculator.isEmpty(b)&&a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},PixelCalculator.emptyPixel=[0,0,0,0],PixelCalculator.getImageData=function(a,b,c){"use strict";var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.drawImage(a,0,0,b,c),e.getImageData(0,0,b,c)},PixelCalculator.cloneImageData=function(a){"use strict";if(void 0!==a){var b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.putImageData(a,0,0),c.getImageData(0,0,b.width,b.height)}},PixelCalculator.coordsToindex=function(a,b,c){"use strict";var d=Math.floor(c)*(a.width<<2)+(b<<2);return d<a.data.length?d:void 0},PixelCalculator.poke=function(a,b,c,d){"use strict";if(void 0!==d){var e=PixelCalculator.coordsToindex(a,b,c);void 0!==e&&(a.data[e]=d[0],a.data[e+1]=d[1],a.data[e+2]=d[2],a.data[e+3]=d[3])}},PixelCalculator.peek=function(a,b,c){"use strict";var d=PixelCalculator.coordsToindex(a,b,c);return void 0!==d?[a.data[d],a.data[d+1],a.data[d+2],a.data[d+3]]:PixelCalculator.emptyPixel},PixelCalculator.resize=function(a,b,c){"use strict";var d=document.createElement("canvas"),e=d.getContext("2d");return d.width=b,d.height=c,e.putImageData(a,0,0,0,0,b,c),e.getImageData(0,0,b,c)},PixelCalculator.toYUV=function(a){"use strict";return[.299*a[0]+.587*a[1]+.114*a[2],a[0]*-.14713+a[1]*-.28886+.436*a[2],.615*a[0]+a[1]*-.51499+a[2]*-.10001]};